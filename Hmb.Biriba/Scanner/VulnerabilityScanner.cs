using Hmb.Biriba.FileSystem;
using Hmb.Biriba.SpecFormats;
using Hmb.Biriba.SpecFormats.PostmanV2_1_0;
using Microsoft.Extensions.Options;

namespace Hmb.Biriba.Scanner;

public class VulnerabilityScanner
{
    private readonly FileReader _fileReader;
    private readonly IEnumerable<ISpecFormatReader> _specFormatReaders;

    public VulnerabilityScanner(FileReader fileReader, IEnumerable<ISpecFormatReader> specFormatReaders)
    {
        _fileReader = fileReader;
        _specFormatReaders = specFormatReaders;
    }

    public async Task RunVulnerabilityScan(SpecFormats.SpecReaderFormat specificationFormat, string specificationFilePath)
    {
        using Stream specStream = await _fileReader.GetStreamAsync(specificationFilePath);
        ISpecFormatReader reader = _specFormatReaders.First(r => r.Format == specificationFormat);
        await foreach (var item in reader.GetParametricRequestsAsync(specStream))
        {

        }
    }
}
